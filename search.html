<html>

	<head>
		<title>Jones DVD Search</title>
		<link rel="stylesheet" href="style.css" type="text/css"/>
	</head>

	<body>

		<div id="header">
			<a href="index.html" id="home"><h1>Jones Media Center</h1></a>

			<form action="search.html" method="get">
				<input id="searchField" type="text" name="search" value="Search for Movies">
				<input type="submit" value="Search">
			</form>
		</div>

		<h3 id='displaySearchTerm'>
			Search results for:&nbsp;<span id='searchTerm'><i></i></span>
		</h3>
		<!-- Where search results will be displayed -->
		<div id="searchResultsWrapper">
			<div id="searchResults">
				<!-- Need some kind of loading message -->
			</div>
		</div>

		<script src='js/jquery-1.11.0.js'></script>

		<!-- Javascript that makes a axaj call to search.php and then takes that information and displays it on this page -->
		<script>
			$(document).ready(function(){
				var get_results = window.location.search.substring(1);
				var search_term = get_results.split("=");
				search = search_term[1].split("+").join(" ");

				$('#searchTerm > i').html(search);
				$('#searchField').attr("value", search);

				$.get("search_results.php?search=\"" + search_term[1] + "\"", 
					function(response){
						console.log("search_results.php returned");
						console.log(response);
					
						// Parse the JSON object that is returned
						var jsonObj = $.parseJSON(JSON.stringify(response));

						if (jsonObj.length == 0){
							console.log("Empty Json");
							var movie = $('<div>', {
								'class' : 'movieResult noResults',
								html : "No search results found."
							});
							movie.appendTo($('#searchResults'));
						}

						$.each(jsonObj, function(index, obj){
							
							console.log(obj.location);

							var movieHtml = [];

							// Add image.
							movieHtml.push('<div><img class="movieImage" src="' + obj.image_path + 
							 '"></img></div>');

							// Add title
							movieHtml.push('<div class="movieInfo"><strong><h2 class="title">' + obj.title + '</h2></strong>');

							// Add media
							movieHtml.push('<span class="media">' + obj.media + ' </span>');

							// Add summary (only if there is one)
							if (obj.summary != ""){
								movieHtml.push('<div class="summary">' + obj.summary.substr(0, 500));

								if (obj.summary.length > 500)
									movieHtml.push('...</div>');
								else
									movieHtml.push('</div>');
							}

							// Add location, call number, status
							// $.each(obj.location, function(index, row){
							// 	movieHtml.push("<br/>" + row.type + "  " +
							// 		row.callnumber + "  " +
							// 		row.status);
							// })

							// Add accession number
							if (obj.location.length == 1) {
								if (obj.media == "DVD" || obj.media == "VHS"){
									movieHtml.push("<br/><strong>Call Number:</strong> " + obj.accession_number + " <br/><strong>Status: </strong>" + obj.location[0].status);
								} else {
									movieHtml.push("<br/>On Reserve for " + obj.location[0].callnumber + "   " + obj.location[0].status);
								}
							}
							else {
								$.each(obj.location, function(index, row){
						 			movieHtml.push("<br/>" + row.type + "  " +
							 		row.callnumber + "  " +
							 		row.status);
								 })
							}

							// Add cast (only if there is one)
							if (obj.cast != "")
								movieHtml.push('<br/><br/><div class="cast"><strong>Cast: </strong>' + obj.cast + '</div>');

							// Closing the information div. 
							movieHtml.push("</div>");

							var movie = $('<div>', {
								'class' : 'movieResult',
								html : movieHtml.join('')
							});

							if (index % 2 == 0)
								movie.attr('class', 'movieResult altColor');

							movie.appendTo($('#searchResults'));

						});
					},
					"json");
			});
		</script> 

	</body>

</html>