<!DOCTYPE html>
<html>

	<head>
		<title>Jones DVD Search</title>
		<link rel="stylesheet" type="text/css" href="resources/css/bootstrap-custom.css" />

		<script type="text/javascript" src="libraries/jquery/js/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="resources/js/DisplaySearch.js"></script>

		<!-- Javascript that makes a axaj call to search.php and then takes that information and displays it on this page -->
		<script type="text/javascript">

			$(document).ready(function(){
				$('.loading').hide();
				$('.last-updated').hide(); // Hiding a tag added in by omni update.
				$('#searchResultsWrapper').hide();

				$('#header').load('header.html', function(){
					$('.search-field').attr("value", search);
				});

				var get_results = window.location.search.substring(1);
				var search_term = get_results.split("=");
				var search = search_term[1].split("+").join(" ");

				$('#searchTerm > i').html(search);


				$.get("resources/php/search.php", { search: search_term[1] }, function(response) {
						console.log(response);
						$('#searchResultsWrapper').fadeIn(200);
						$.each(response['bib_numbers'], function (k, v){
							$.get("resources/php/MovieRecord.php", { bibnum: v }, function(info){
								displayResult(info);
							}, "json")
							.fail(function(data) {
								console.log(data);
							});
						});
						$('.loading').fadeOut(200);
					}, "json")
					  .fail(function(data) {
						console.log(data);
					});

			});

			$(document).ajaxStart(function(){
				$('.loading').html('<img class="center-block" src="resources/images/Loader.gif">');
				$('.loading').fadeIn(400);
			});

			// $(document).ajaxStop(function(){
			// 	$('.loading').fadeOut(700, function(){
			// 		$('#searchResultsWrapper').fadeIn(700);
			// 	});
			// });

		</script>
	</head>

	<body>

		<div id="header"></div>

		<div class="container">
			<h3 id="displaySearchTerm">
				Search results for:&nbsp;<span id="searchTerm"><i></i></span>
			</h3>

			<!-- Where search results will be displayed -->
			<div id="searchResultsWrapper">
				<div id="searchResults">
					<!-- Need some kind of loading message -->
				</div>
			</div>
		</div>

		<!-- Loading Image. Only shown when axaj call has been made and hasn't returned. -->
		<div class="loading"></div>


	</body>

</html>
